<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Xoops4-svn] r51 - in XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj: . plugins
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/xoops4-svn/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:xoops4-svn%40lists.berlios.de?Subject=Re%3A%20%5BXoops4-svn%5D%20r51%20-%20in%20XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj%3A%20.%20plugins&In-Reply-To=%3C200511292318.jATNIPC1026763%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000043.html">
   <LINK REL="Next"  HREF="000045.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Xoops4-svn] r51 - in XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj: . plugins</H1>
    <B>skalpa at BerliOS</B> 
    <A HREF="mailto:xoops4-svn%40lists.berlios.de?Subject=Re%3A%20%5BXoops4-svn%5D%20r51%20-%20in%20XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj%3A%20.%20plugins&In-Reply-To=%3C200511292318.jATNIPC1026763%40sheep.berlios.de%3E"
       TITLE="[Xoops4-svn] r51 - in XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj: . plugins">skalpa at berlios.de
       </A><BR>
    <I>Wed Nov 30 00:18:25 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000043.html">[Xoops4-svn] r50 - XoopsCore/branches/tasks/121476-tplset-remove/htdocs/include
</A></li>
        <LI>Next message: <A HREF="000045.html">[Xoops4-svn] r52 - XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Theme.xoobj
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44">[ date ]</a>
              <a href="thread.html#44">[ thread ]</a>
              <a href="subject.html#44">[ subject ]</a>
              <a href="author.html#44">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: skalpa
Date: 2005-11-30 00:18:24 +0100 (Wed, 30 Nov 2005)
New Revision: 51

Added:
   XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/compiler.xoAppUrl.php
   XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/compiler.xoImgUrl.php
   XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/resource.xotpl.php
   XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/smarty.php
   XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/xo-info.php
Modified:
   XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/resource.db.php
Log:
Added missing files from xoops_template_Smarty I forgot to add to the SVN

Added: XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/compiler.xoAppUrl.php
===================================================================
--- XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/compiler.xoAppUrl.php	2005-11-29 10:21:30 UTC (rev 50)
+++ XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/compiler.xoAppUrl.php	2005-11-29 23:18:24 UTC (rev 51)
@@ -0,0 +1,26 @@
+&lt;?php
+/**
+* xoAppUrl Smarty compiler plug-in
+*
+* See the enclosed file LICENSE for licensing information.
+* If you did not receive this file, get it at <A HREF="http://www.fsf.org/copyleft/gpl.html">http://www.fsf.org/copyleft/gpl.html</A>
+*
+* @copyright    The XOOPS project <A HREF="http://www.xoops.org/">http://www.xoops.org/</A>
+* @license      <A HREF="http://www.fsf.org/copyleft/gpl.html">http://www.fsf.org/copyleft/gpl.html</A> GNU public license
+* @author		Skalpa Keo &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/xoops4-svn">skalpa at xoops.org</A>&gt;
+* @package		xoops_template
+* @subpackage	xoops_template_Smarty
+* @since        2.3.0
+* @version		$Id$
+*/
+
+function smarty_compiler_xoAppUrl( $argStr, &amp;$smarty ) {
+	global $xoops;
+	
+	$argStr = trim( $argStr );
+	
+	return &quot;\necho '&quot; . addslashes( $xoops-&gt;path( $argStr, true ) ) . &quot;';&quot;;
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/compiler.xoAppUrl.php
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:keywords
   + &quot;Author Date Id Rev URL&quot;

Added: XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/compiler.xoImgUrl.php
===================================================================
--- XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/compiler.xoImgUrl.php	2005-11-29 10:21:30 UTC (rev 50)
+++ XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/compiler.xoImgUrl.php	2005-11-29 23:18:24 UTC (rev 51)
@@ -0,0 +1,33 @@
+&lt;?php
+/**
+* xoImgUrl Smarty compiler plug-in
+*
+* See the enclosed file LICENSE for licensing information.
+* If you did not receive this file, get it at <A HREF="http://www.fsf.org/copyleft/gpl.html">http://www.fsf.org/copyleft/gpl.html</A>
+*
+* @copyright    The XOOPS project <A HREF="http://www.xoops.org/">http://www.xoops.org/</A>
+* @license      <A HREF="http://www.fsf.org/copyleft/gpl.html">http://www.fsf.org/copyleft/gpl.html</A> GNU public license
+* @author		Skalpa Keo &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/xoops4-svn">skalpa at xoops.org</A>&gt;
+* @package		xoops_template
+* @subpackage	xoops_template_Smarty
+* @since        2.3.0
+* @version		$Id$
+*/
+
+function smarty_compiler_xoImgUrl( $argStr, &amp;$smarty ) {
+	global $xoops;
+	
+	$argStr = trim( $argStr );
+	
+	if ( isset($smarty-&gt;template_engine-&gt;currentTheme) ) {
+		$path = $smarty-&gt;template_engine-&gt;currentTheme-&gt;resourcePath( $argStr );
+	} else {
+		$path = $argStr;
+	}
+
+	return &quot;\necho '&quot; . addslashes( $xoops-&gt;url( $path ) ) . &quot;';&quot;;
+
+} 
+
+
+?&gt;
\ No newline at end of file


Property changes on: XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/compiler.xoImgUrl.php
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:keywords
   + &quot;Author Date Id Rev URL&quot;

Modified: XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/resource.db.php
===================================================================
--- XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/resource.db.php	2005-11-29 10:21:30 UTC (rev 50)
+++ XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/resource.db.php	2005-11-29 23:18:24 UTC (rev 51)
@@ -89,6 +89,10 @@
 			trigger_error( &quot;Cannot create db: resource handler templates list&quot;, E_USER_WARNING );
 		}
 	}
+	
+	if ( $tplName == 'system_notification_select.html' ) {
+		$tplName = 'system_notification_select.xotpl';
+	}
 	if ( isset( $list[$tplName] ) ) {
 		return $xoops-&gt;path( $list[$tplName] );
 	}

Added: XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/resource.xotpl.php
===================================================================
--- XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/resource.xotpl.php	2005-11-29 10:21:30 UTC (rev 50)
+++ XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/resource.xotpl.php	2005-11-29 23:18:24 UTC (rev 51)
@@ -0,0 +1,71 @@
+&lt;?php
+/**
+ * Smarty plugin
+ * 
+ * Kept for XOOPS 2.0 backward compatibility only !!!
+ * 
+ * Use the new xotpl: handler to access XOOPS templates
+ * ------------------------------------------------------------- 
+ * File:     resource.db.php
+ * Type:     resource
+ * Name:     db
+ * Purpose:  Fetches templates from a database
+ * -------------------------------------------------------------
+ * @package xoops20
+ * @deprecated
+ */
+
+function smarty_resource_xotpl_source($tpl_name, &amp;$tpl_source, &amp;$smarty) {
+
+	if ( $tplPath = smarty_resource_xotpl_getpath( $tpl_name, $smarty ) ) {
+		if ( $tpl_source = file_get_contents( $tplPath ) ) {
+			$smarty-&gt;realTemplatePath = $tplPath;
+			return true;
+		}
+	}
+	return false;
+}
+
+function smarty_resource_xotpl_timestamp($tpl_name, &amp;$tpl_timestamp, &amp;$smarty) {
+
+	if ( $tplPath = smarty_resource_xotpl_getpath( $tpl_name, $smarty ) ) {
+		if ( $tpl_timestamp = filemtime( $tplPath ) ) {
+			return true;
+		}
+	}
+	return false;
+}
+
+function smarty_resource_xotpl_secure($tpl_name, &amp;$smarty) {
+    return true;
+}
+
+function smarty_resource_xotpl_trusted($tpl_name, &amp;$smarty) {
+	return false;
+}
+
+function smarty_resource_xotpl_getpath( $tplName, &amp;$smarty ) {
+	global $xoops;
+	
+	if ( $smarty-&gt;currentTheme ) {
+		$name = str_replace( '/templates/', '/', $tplName );
+		$themed = $smarty-&gt;currentTheme-&gt;resourcePath( $name );
+		if ( substr( $themed, 0, 7 ) == 'themes/' ) {
+			$tplName = $themed;
+		} elseif ( substr( $tplName, -6 ) == '.xotpl' ) {
+			// If the template is not in the theme folder,
+			// check if it's not here, but with an .html extension
+			$name = substr( $name, 0, -6 ) . '.html';
+			$themed = $smarty-&gt;currentTheme-&gt;resourcePath( $name );
+			if ( substr( $themed, 0, 7 ) == 'themes/' ) {
+				$tplName = $themed;
+			}
+		}
+	}
+	return $xoops-&gt;path( $tplName );
+
+}
+
+
+
+?&gt;
\ No newline at end of file


Property changes on: XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/plugins/resource.xotpl.php
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:keywords
   + &quot;Author Date Id Rev URL&quot;

Added: XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/smarty.php
===================================================================
--- XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/smarty.php	2005-11-29 10:21:30 UTC (rev 50)
+++ XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/smarty.php	2005-11-29 23:18:24 UTC (rev 51)
@@ -0,0 +1,111 @@
+&lt;?php
+/**
+ * xoops_template_Smarty component main file
+ *
+ * See the enclosed file LICENSE for licensing information.
+ * If you did not receive this file, get it at <A HREF="http://www.fsf.org/copyleft/gpl.html">http://www.fsf.org/copyleft/gpl.html</A>
+ *
+ * @copyright   The Xoops project <A HREF="http://www.xoops.org/">http://www.xoops.org/</A>
+ * @license     <A HREF="http://www.fsf.org/copyleft/gpl.html">http://www.fsf.org/copyleft/gpl.html</A> GNU public license
+ * @since       2.3.0
+ * @package		xoops_template
+ * @subpackage	xoops_template_Smarty
+ * @version		$Id$
+ * @author		Skalpa Keo &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/xoops4-svn">skalpa at xoops.org</A>&gt;
+ */
+
+XOS::import( 'Smarty' );
+
+/**
+ * XOOPS core default Smarty implementation
+ * @since        2.3.0
+ * @package		xoops_template
+ * @subpackage	xoops_template_Smarty
+ */
+class xoops_template_Smarty extends Smarty {
+	
+	var $left_delimiter =	'([';
+	var $right_delimiter =	'])';
+
+	var $template_dir		= XOOPS_THEME_PATH;
+	var $compile_dir		= 'var/Application Support/xoops_template_Smarty';
+	var $cache_dir			= 'var/Caches/xoops_template_Smarty';
+
+	var $use_sub_dirs		= false;
+	
+	
+	var $currentFile		= '';
+
+	/**
+	 * Theme to apply to this template (if any)
+	 * 
+	 * @var object
+	 */
+	var $currentTheme		= false;
+	
+
+	function xoops_template_Smarty( $options = null ) {
+		global $xoops;
+		
+		$this-&gt;compile_dir	= $xoops-&gt;path( $this-&gt;compile_dir );
+		$this-&gt;cache_dir	= $xoops-&gt;path( $this-&gt;cache_dir );
+
+		if ( $xoops-&gt;xoRunMode &amp; XO_MODE_DEV_MASK ) {
+			$this-&gt;compile_check = true;
+			$this-&gt;force_compile = true;
+			//$this-&gt;debugging = true;
+		}
+		$this-&gt;Smarty();
+
+		$path = str_replace( DIRECTORY_SEPARATOR, '/', dirname( __FILE__ ) );
+
+		array_unshift( $this-&gt;plugins_dir, &quot;$path/plugins&quot; );
+		array_unshift( $this-&gt;plugins_dir, &quot;$path/smarty/plugins&quot; );
+		
+		$this-&gt;register_prefilter( array( &amp;$this, 'filterOldTemplates' ) );
+		
+		$this-&gt;assign_by_ref( 'xoops', $xoops );
+	}
+
+	
+    function display( $resource_name = null, $cache_id = null, $compile_id = null) {
+        return $this-&gt;fetch( $resource_name, $cache_id, $compile_id, true );
+    }
+
+    function fetch( $resource_name = null, $cache_id = null, $compile_id = null, $display = false) {
+    	if ( !isset( $resource_name ) ) {
+    		$resource_name = $this-&gt;currentFile;
+    	} else {
+    		$this-&gt;currentFile = $resource_name;
+    	}
+    	return parent::fetch( $resource_name, $cache_id, $compile_id, $display );
+    }
+
+	/**
+	 * Render output from template data
+	 * 
+	 * @param   string  $data		The template to render
+	 * @param	bool	$display	If rendered text should be output or returned
+	 * @return  string  Rendered output if $display was false
+	 **/
+    function fetchFromData( $tplSource, $display = false ) {
+        if ( !function_exists('smarty_function_eval') ) {
+            require_once SMARTY_DIR . '/plugins/function.eval.php';
+        }
+        return smarty_function_eval( array('var' =&gt; $tplSource), $this );
+    }
+
+	/**
+	 * Compiler prefilter to change 2.0 style delimiters to new ones
+	 */
+    function filterOldTemplates( $data, &amp;$compiler ) {
+    	$file = ( substr( $compiler-&gt;_current_file, 0, 6 ) == 'xotpl:' ) ? $this-&gt;realTemplatePath : $compiler-&gt;_current_file;
+		if ( substr( $file, -5 ) == '.html' ) {
+			$data = str_replace( array( '&lt;{', '}&gt;' ), array( '([', '])' ), $data );
+		}
+    	return $data;
+    }
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/smarty.php
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:keywords
   + &quot;Author Date Id Rev URL&quot;

Added: XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/xo-info.php
===================================================================
--- XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/xo-info.php	2005-11-29 10:21:30 UTC (rev 50)
+++ XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/xo-info.php	2005-11-29 23:18:24 UTC (rev 51)
@@ -0,0 +1,26 @@
+&lt;?php
+/**
+* xoops_template_Smarty bundle information file
+*
+* See the enclosed file LICENSE for licensing information.
+* If you did not receive this file, get it at <A HREF="http://www.fsf.org/copyleft/gpl.html">http://www.fsf.org/copyleft/gpl.html</A>
+*
+* @copyright    The XOOPS project <A HREF="http://www.xoops.org/">http://www.xoops.org/</A>
+* @license      <A HREF="http://www.fsf.org/copyleft/gpl.html">http://www.fsf.org/copyleft/gpl.html</A> GNU public license
+* @since        2.3.0
+* @version		$Id$
+* @author		Skalpa Keo &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/xoops4-svn">skalpa at xoops.org</A>&gt;
+*/
+
+return array(
+	'xoBundleDisplayName' =&gt; 'Smarty template engine (XOOPS version)',
+	'xoBundleIdentifier' =&gt; 'xoops_template_Smarty',
+	'xoClassPath' =&gt; '/smarty.php',
+	'xoServices' =&gt; array(
+		'Smarty' =&gt; array(
+			'xoClassPath' =&gt; '/smarty/Smarty.class.php',
+		),
+	),
+);
+
+?&gt;
\ No newline at end of file


Property changes on: XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Smarty.xoobj/xo-info.php
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:keywords
   + &quot;Author Date Id Rev URL&quot;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000043.html">[Xoops4-svn] r50 - XoopsCore/branches/tasks/121476-tplset-remove/htdocs/include
</A></li>
	<LI>Next message: <A HREF="000045.html">[Xoops4-svn] r52 - XoopsCore/branches/tasks/121476-tplset-remove/XOOPS/Frameworks/XoopsCore/Pyro/Theme.xoobj
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44">[ date ]</a>
              <a href="thread.html#44">[ thread ]</a>
              <a href="subject.html#44">[ subject ]</a>
              <a href="author.html#44">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/xoops4-svn">More information about the Xoops4-svn
mailing list</a><br>
</body></html>
